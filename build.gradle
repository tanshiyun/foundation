/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'maven-publish'
}

repositories {
    mavenLocal()
    maven {
        url = uri('https://maven.aliyun.com/repository/public/')
    }
}

ext {
    springBootVersion = '2.5.1'
    lombokVersion = '1.18.18'
    mapStructVersion = '1.4.2.Final'
}


allprojects {
    group = 'com.foundation'
    version = '0.0.1-SNAPSHOT'
    description = 'foundation'
    java.sourceCompatibility = JavaVersion.VERSION_1_8

    apply plugin: 'java-library'
    apply plugin: 'maven-publish'

    configurations {
        compileOnly {
            extendsFrom annotationProcessor
        }
        all*.exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }

    jar {
        // 对没有文件的module不进行打包
        onlyIf { !sourceSets.main.allSource.files.isEmpty() }
    }
}

subprojects {

    dependencies {
        implementation "org.springframework.boot:spring-boot-starter-data-jpa:${springBootVersion}"
        implementation "org.springframework.boot:spring-boot-starter-web:${springBootVersion}"
        implementation "org.springframework.boot:spring-boot-starter-thymeleaf:${springBootVersion}"
        implementation "org.springframework.boot:spring-boot-starter-freemarker:${springBootVersion}"
        implementation "org.springframework.boot:spring-boot-starter-mail:${springBootVersion}"
        implementation "org.springframework.boot:spring-boot-starter-log4j2:${springBootVersion}"
        implementation "org.mybatis.spring.boot:mybatis-spring-boot-starter:1.3.3"
        testImplementation "org.springframework.boot:spring-boot-starter-test:${springBootVersion}"

        implementation group: 'org.mybatis.spring.boot', name: 'mybatis-spring-boot-starter', version: '2.2.0'

        implementation group: 'com.alibaba', name: 'druid-spring-boot-starter', version: '1.2.8'
        implementation group: 'org.postgresql', name: 'postgresql', version: '42.3.3'
        implementation group: 'cn.afterturn', name: 'easypoi-base', version: '4.4.0'
        implementation group: 'cn.afterturn', name: 'easypoi-annotation', version: '4.4.0'
        implementation group: 'cn.afterturn', name: 'easypoi-web', version: '4.4.0'

        // mapstruct
        implementation "org.mapstruct:mapstruct:${mapStructVersion}"
        annotationProcessor "org.mapstruct:mapstruct-processor:${mapStructVersion}"
        testAnnotationProcessor "org.mapstruct:mapstruct-processor:${mapStructVersion}"

        // lombok
        compileOnly group: 'org.projectlombok', name: 'lombok', version: "${lombokVersion}"
        testCompileOnly group: 'org.projectlombok', name: 'lombok', version: "${lombokVersion}"

        annotationProcessor group: 'org.projectlombok', name: 'lombok', version: "${lombokVersion}"
        testAnnotationProcessor group: 'org.projectlombok', name: 'lombok', version: "${lombokVersion}"

        annotationProcessor "org.projectlombok:lombok-mapstruct-binding:0.2.0"
        testAnnotationProcessor "org.projectlombok:lombok-mapstruct-binding:0.2.0"
    }

    publishing {
        publications {
            maven(MavenPublication) {
                //指定group/artifact/version信息
                groupId project.group
                artifactId project.name
                version project.version
                //打包类型 war: components.web jar: components.java
                from components.java
                //配置上传源码
            }
        }
    }
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}
